<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ATC Radar</title>
    <link rel="stylesheet" href="style.css" />
    <script src="./libs/sql-wasm.js"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Google+Sans+Code:wght@300..800&display=swap');
    </style>
  </head>
  <body>
    <div id="game-container">
      <div id="canvas-stack">
        <canvas id="navdata-canvas" width="2160" height="2160"></canvas>
        <canvas id="radar-scope" width="2160" height="2160"></canvas>  
        
        <input type="number" id="tag-input" />
        <input type="text" id="waypoint-input" />
        <div id="waypoint-suggestions"></div>
      </div>
      <div id="procedures-panel" class="procedures-panel" style="display:none;">
        <div class="procedures-header">
          <h3 id="proc-plane-id">Procedure</h3>
          <div id="proc-assigned">No procedure assigned</div>
        </div>
        <div id="proc-body">
          <div class="proc-section">
            <label>STARs (not implemented)</label>
            <div id="star-list" class="proc-list">(No STARs)</div>
          </div>
          <div class="proc-section">
            <label>Approaches</label>
            <div id="approach-list" class="proc-list"></div>
          </div>
          <div class="proc-section">
            <label>Transitions</label>
            <div id="transition-list" class="proc-list">(Select an approach)</div>
          </div>
          <button id="assign-proc">Assign</button>
          <button id="close-proc">Close</button>
        </div>
      </div>
    </div>

    <script type="module" src="js/main.js"></script>
    
    <div id="login-overlay">
      <div id="login-modal">
        <h2 class="modal-title">Login Required</h2>
        <p>
          Our navigation data used to provide you with a realistic experience is provided by Navigraph. To access the data, you need to log in with your Navigraph account.
        </p>
        <p>Please log in to continue.</p>
        <p class="auth-plan-note"><strong>Note:</strong> Accounts on the free plan will use an older AIRAC cycle. Users with <strong>active</strong> subscriptions will receive the latest AIRAC cycle.</p>
        <button id="login-button" class="login-button" type="button">Login with Navigraph</button>
      </div>
    </div>
    
      <div id="airport-overlay">
        <div id="airport-modal">
          <h2 class="modal-title">Select Airport</h2>
          <p>Please choose an airport to load navigation data for the simulation.</p>
          <div id="airport-list"></div>
          <button id="airport-select-btn">Load Selected Airport</button>
        </div>
      </div>
  </body>
  <script>
    // Resolve correct auth URL for local development vs production (Vercel)
    (function() {
      const btn = document.getElementById('login-button');
      if (!btn) return;

      // If running locally, send auth requests to the server IP; otherwise let Vercel handle /api
      const SERVER_IP = 'http://92.4.166.252:3000';
      const isLocal = ['localhost', '127.0.0.1'].includes(window.location.hostname);
      let authUrl = isLocal ? `${SERVER_IP}/api/auth/login` : '/api/auth/login';

      btn.addEventListener('click', () => {
        window.location.href = authUrl;
      });
    })();
  </script>
</html>
